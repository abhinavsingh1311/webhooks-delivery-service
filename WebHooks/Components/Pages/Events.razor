@page "/events"
@using Webhooks_System_Library.Entities
@rendermode InteractiveServer
<h3>Events</h3>


 <div class="container">
 
    @if(errors.Count() > 0){
      <div class="alert alert-danger">
        <ul>
          @foreach(var error in errors){
            <li>@error</li>
          }
        </ul>
      </div>
    }

  <div class="mb-4">
   <!-- Event management UI goes here -->
     <div class="container-lg flex-columns">
     <h3 class="mb-3">Filter</h3>
            <button class="btn mb-3 @(selectedFilter == null ? "btn-primary" : "btn-outline-primary")"
                    @onclick="() => FilterChanged(null)">
                All
            </button>

            <button class="btn mb-3 @(selectedFilter == WebHookStatus.Pending ? "btn-primary" : "btn-outline-primary")"
                    @onclick="() => FilterChanged(WebHookStatus.Pending)">
                Pending
            </button>

            <button class="btn mb-3 @(selectedFilter == WebHookStatus.Delivered ? "btn-success" : "btn-outline-success")"
                    @onclick="() => FilterChanged(WebHookStatus.Delivered)">
                Delivered
            </button>

            <button class="btn mb-3 @(selectedFilter == WebHookStatus.Failed ? "btn-danger" : "btn-outline-danger")"
                    @onclick="() => FilterChanged(WebHookStatus.Failed)">
                Failed
            </button>

            <button class="btn mb-3 @(selectedFilter == WebHookStatus.DeadLetter ? "btn-warning" : "btn-outline-warning")"
                    @onclick="() => FilterChanged(WebHookStatus.DeadLetter)">
                Dead Letter
            </button>
     </div>
     
     <table>
       <thead>
         <tr>
             <th>EventID</th>
             <th>Event Type</th>
             <th>Payload</th>
             <th>Status</th>
             <th>Attempt Count</th>
             <th>Last Response Code</th>
             <th>Created At </th>
             <th>Delivered At</th>
         </tr>
       </thead>
       
       <tbody>
         @foreach(var ev in events){
           <tr>
             <td>@ev.EventPointId</td>
             <td>@ev.EventType</td>
             <td>@ev.Status</td>
             <td>@ev.AttemptCount</td>
             <td>@ev.LastResponsecode</td>
             <td>@ev.CreatedAt</td>
             <td>@ev.DeliveredAt</td>
           </tr>
         }
       </tbody>
     </table>

  </div>

  <!--Test Event form-->

  <div class="mb-4 flex-column">
      <h3>Send Test Event</h3>
    <div class="form-group mb-2">
       
          <!--dropdown to select endpoint-->
          <select @bind="newEvent.EventPointId">
              <option value="">Select Endpoint</option>
              @foreach (var ep in endpoints)
              {
                  <option value="@ep.Id">@ep.Name (@ep.Url)</option>
              }
        </select>
        <!--Text box for event type  -->
          <label for="eventType">Event Type:</label>
          <input type="text" @bind="newEvent.EventType" />
          <!--Text Area for payload json-->
          <label for="payload">Payload (JSON):</label>
          <textarea @bind="newEvent.Payload" rows="5" cols="50"></textarea>
          
          <button type="button" class="btn btn-primary mt-2" @onclick="() => SubmitHandler()">Send Test Event</button>

    </div>
    
    <div class="form-group mb-2">
    </div>
  </div>
</div>


@code {

}
